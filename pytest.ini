"""
Pytest 配置

配置 pytest 测试框架的参数和插件。
"""

import os
import sys
from pathlib import Path

# 将项目根目录添加到 Python 路径
PROJECT_ROOT = Path(__file__).resolve().parent.parent
sys.path.insert(0, str(PROJECT_ROOT))

# 设置 Django 设置模块
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

# Django 设置
import django
django.setup()

# Pytest 配置
pytest_plugins = [
    "pytest_django",
]

# 测试数据库配置
DJANGO_SETTINGS_MODULE = "config.settings"

# 测试发现配置
testpaths = [
    "tests",
]

# 覆盖率配置
addopts = [
    "--cov=apps",
    "--cov-report=html",
    "--cov-report=term-missing",
    "--cov-fail-under=80",
    "-v",
    "--tb=short",
]

# 标记配置
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "unit: marks tests as unit tests",
    "api: marks tests as API tests",
    "model: marks tests as model tests",
    "service: marks tests as service tests",
]